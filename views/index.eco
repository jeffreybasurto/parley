<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html>
  <head>
    <link rel="StyleSheet" href="style.css" type="text/css" media="screen">
    <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.1.7/underscore-min.js"></script>
    <script src="http://parley-shard-one.herokuapp.com/socket.io/socket.io.js"></script>
    
    <script type="text/javascript">
      $(function() {
        var addCommas;
        addCommas = function(number) {
          return number.toString().replace(/\B(?=(?:\d{3})+(?!\d))/g, ",");
        };
        var $messages = $("#messages-sent");
        $messages.text(addCommas($messages.text()));
        var socket = io.connect('<%= "http://parley-shard-one.herokuapp.com" %>');
        var throttled = _.throttle(function(value) {
          $messages.text(addCommas(value));
        }, 100);
        
        socket.emit("challenge", {"key": "1"});
        socket.on('update', function (data) {
          throttled(data["messages"]);
        });
      });
    </script>
    <title></title>
  </head>
  <body>
    <div class="column">
      <h1>
         Add <b>realtime</b> events to your app
      </h1>
      <p>
        Parley is a hosted API for quickly, easily and securely adding scalable realtime functionality via web technology to desktop and mobile apps.
      </p>
      <div id="messages-container">
        <div id="messages-sent">
          <%= @messages %>
        </div>
        <p>
          messages<br>
          delivered
        </p>
      </div>
    </div>
  </body>
</html>
